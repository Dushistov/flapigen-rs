use std::mem;
use std::ptr;
use std::ffi::CStr;
use std::rc::Rc;
use std::cell::RefCell;

use jni::{jint, JNIEnv, jclass, jlong, jstring, jdouble, jfloat, jboolean};

struct Foo {
    data: i32,
    name: String
}

impl Foo {
    fn new(val: i32, name: &str) -> Foo {
        println!("name: {}", name);
        Foo{data: val, name: name.to_string()}
    }

    fn f(&self, a: i32, b: i32) -> i32 {
        self.data + a + b
    }

    fn name(&self) -> &str {
        &self.name
    }

    fn f_double(&self, a: f64, b: f64) -> f64 {
        a.hypot(b) + self.data as f64
    }
}

foreigner_class!(class Foo {
    self_type Foo;
    constructor Foo::new(_: i32, _: &str) -> Foo;
    method Foo::f(&self, _: i32, _: i32) -> i32;
    method Foo::f_double(&self, _: f64, _: f64) -> f64;
    method Foo::name(&self) -> &str;
});

struct Boo {}

impl Boo {
    fn new() -> Boo { Boo{} }
    fn test(&self, a: bool) -> f32 {
        if a { ::std::f32::consts::E } else { ::std::f32::consts::PI }
    }
}

fn create_boo() -> Rc<RefCell<Boo>> {
    Rc::new(RefCell::new(Boo::new()))
}

foreigner_class!(class Boo {
    self_type Boo;
    constructor create_boo() -> Rc<RefCell<Boo>>;
    method Boo::test(&self, _: bool) -> f32;
});
